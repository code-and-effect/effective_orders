class UpgradeEffectiveOrdersFrom03x < ActiveRecord::Migration
  def self.up
    if Effective::OrderItem.new().price.kind_of?(Integer) == false
      ActiveRecord::Base.connection.execute("UPDATE <%= @order_items_table_name.gsub(':', '') %> O SET price = (O.price * 100.0)")
      change_column <%= @order_items_table_name %>, :price, :integer, :default => 0
    end

    if Effective::Subscription.new().price.kind_of?(Integer) == false
      ActiveRecord::Base.connection.execute("UPDATE <%= @subscriptions_table_name.gsub(':', '') %> O SET price = (O.price * 100.0)")
      change_column <%= @subscriptions_table_name %>, :price, :integer, :default => 0
    end
  end

  def self.down
    if Effective::OrderItem.new().price.kind_of?(Integer) == true
      change_column <%= @order_items_table_name %>, :price, :decimal, :precision => 8, :scale => 2, :default => 0.0
      ActiveRecord::Base.connection.execute("UPDATE <%= @order_items_table_name.gsub(':', '') %> O SET price = (O.price / 100.0)")
    end

    if Effective::Subscription.new().price.kind_of?(Integer) == true
      change_column <%= @subscriptions_table_name %>, :price, :decimal, :precision => 8, :scale => 2, :default => 0.0
      ActiveRecord::Base.connection.execute("UPDATE <%= @subscriptions_table_name.gsub(':', '') %> O SET price = (O.price / 100.0)")
    end
  end

end
